package security.br.ufal.ic.temp;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.TimeZone;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.hibernate.exception.DataException;
import java.lang.String;
import security.br.ufal.ic.kernel.KernelClassify;
import security.br.ufal.ic.kernel.ProjectDataControllerKernel;
import security.br.ufal.ic.mozillaOLD.DiffRevision;
import security.br.ufal.ic.xen.XenClassify;

public class DataStepCommit {
	
		public static void main(String[] args) throws ParseException {
//
			ProjectDataControllerKernel dao = new ProjectDataControllerKernel();
//
			SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssz");
			Date result;
			Pattern pattern = Pattern.compile("Date:[ ]+(\\d\\d\\d\\d\\-\\d\\d\\-\\d\\dT\\d\\d\\:\\d\\d\\:\\d\\d[\\-|\\+]\\d\\d\\:\\d\\d)");
			for(KernelClassify kernelobject: dao.getListKenelClassify() ){

				String gitResult = DiffRevision.exe("git log  --date=iso-strict "+kernelobject.getCommit()+" "+"-1");
				//System.out.println(gitResult);

				Matcher matcher;
				try {
					String date="";
					matcher=pattern.matcher(gitResult);
					while(matcher.find()){
						date=matcher.group(1);
					}
					//System.out.println(date);
					result = df.parse(date.substring(0,date.lastIndexOf(":"))+"00");

					//System.out.println(result);
					//System.out.println("date:" + result); // prints date in current
					// locale
					SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss");
					sdf.setTimeZone(TimeZone.getTimeZone("GMT"));
					kernelobject.setDateT(sdf.format(result));
					dao.updateKernelClassify(kernelobject);
				} catch (DataException e) {
					e.getMessage();
				}
			}

		}
		
	}


