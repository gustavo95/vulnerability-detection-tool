package security.br.ufal.ic.webcolector;

import java.io.IOException;
import java.util.ArrayList;

import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

public class BugsVulnerabilities {

	
	//M�todo que coleta todos os c�digos de vulnerabilidade
	public static ArrayList<String> getcodeVulnerabilitiesReport() throws IOException {
		ArrayList<String> temp = new ArrayList<>();
		Document doc = Jsoup.connect("https://www.mozilla.org/en-US/security/advisories/").get();
		Elements newsHeadlines = doc.getElementsByClass("level-item");

		for (int i = 4; i < newsHeadlines.size(); i++) {
			temp.add(newsHeadlines.get(i).getAllElements().get(1).text().substring(0, 12).replace(" ", "").toLowerCase());
		}
		return temp;
	}

	public static void main(String[] args) throws IOException {

		ArrayList<String> aux = getcodeVulnerabilitiesReport();

//		for (String s : aux)
//		System.out.println(s);
		
		
		//C�digo da vulnerabilidade
		
		
//		System.out.println(aux.size());
		//tratar quando cve for > 1
		int temp=0;
		for(int i=0;i<aux.size();i++){
			System.out.println(i);
		//Connection connection = Jsoup.connect("https://www.mozilla.org/en-US/security/advisories/"+aux.get(0));
		Connection connection = Jsoup.connect("https://www.mozilla.org/en-US/security/advisories/"+aux.get(i));
		Document doc = connection.get();

//		Elements elements = doc.getElementsByClass("ex-ref");
		
		Elements elements = doc.getElementsByTag("a");
		for (Element e: elements) {
			if(e.text().contains("bugzilla")){
//				//link do Bug
//				System.out.println(e.text());
////				ids dos Bug
//				System.out.println(e.text().substring(45, 51));}
				temp++;
			}
		}
					
		
		
	}
		System.out.println(temp);
	}
}