package security.br.ufal.ic.moodle;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Table;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.select.Elements;

@Table(name = "VulnerabitiesMoodle")
@Entity
public class VulnerabilitiesMoodle {
	
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private int id;
	
	@Column(name = "bugs")
	private List<BugsMoodle> bugs;
	
	@Column(name = "vulnerability")
	private String vulnerability;
	
	private ArrayList<String> temp;
	
	public VulnerabilitiesMoodle(String vulnerability) throws Exception {
    	temp = new ArrayList<>();
    	bugs = new ArrayList<>();
    	this.vulnerability = vulnerability;
        
    	getCVE("http://www.cvedetails.com/vulnerability-list.php?vendor_id=2105&product_id=3590&version_id=&page=1&hasexp=0&opdos=0&opec=0&opov=0&opcsrf=0&opgpriv=0&opsqli=0&opxss=0&opdirt=0&opmemc=0&ophttprs=0&opbyp=0&opfileinc=0&opginf=0&cvssscoremin=0&cvssscoremax=0&year=0&month=0&cweid=0&order=1&trc=281&sha=9ddd526d6c3de20c88ac1e41f0bc477f1393cc17");
        getCVE("http://www.cvedetails.com/vulnerability-list.php?vendor_id=2105&product_id=3590&version_id=&page=2&hasexp=0&opdos=0&opec=0&opov=0&opcsrf=0&opgpriv=0&opsqli=0&opxss=0&opdirt=0&opmemc=0&ophttprs=0&opbyp=0&opfileinc=0&opginf=0&cvssscoremin=0&cvssscoremax=0&year=0&month=0&cweid=0&order=1&trc=281&sha=9ddd526d6c3de20c88ac1e41f0bc477f1393cc17");
        getCVE("http://www.cvedetails.com/vulnerability-list.php?vendor_id=2105&product_id=3590&version_id=&page=3&hasexp=0&opdos=0&opec=0&opov=0&opcsrf=0&opgpriv=0&opsqli=0&opxss=0&opdirt=0&opmemc=0&ophttprs=0&opbyp=0&opfileinc=0&opginf=0&cvssscoremin=0&cvssscoremax=0&year=0&month=0&cweid=0&order=1&trc=281&sha=9ddd526d6c3de20c88ac1e41f0bc477f1393cc17");
        getCVE("http://www.cvedetails.com/vulnerability-list.php?vendor_id=2105&product_id=3590&version_id=&page=4&hasexp=0&opdos=0&opec=0&opov=0&opcsrf=0&opgpriv=0&opsqli=0&opxss=0&opdirt=0&opmemc=0&ophttprs=0&opbyp=0&opfileinc=0&opginf=0&cvssscoremin=0&cvssscoremax=0&year=0&month=0&cweid=0&order=1&trc=281&sha=9ddd526d6c3de20c88ac1e41f0bc477f1393cc17");
        getCVE("http://www.cvedetails.com/vulnerability-list.php?vendor_id=2105&product_id=3590&version_id=&page=5&hasexp=0&opdos=0&opec=0&opov=0&opcsrf=0&opgpriv=0&opsqli=0&opxss=0&opdirt=0&opmemc=0&ophttprs=0&opbyp=0&opfileinc=0&opginf=0&cvssscoremin=0&cvssscoremax=0&year=0&month=0&cweid=0&order=1&trc=281&sha=9ddd526d6c3de20c88ac1e41f0bc477f1393cc17");
        getCVE("http://www.cvedetails.com/vulnerability-list.php?vendor_id=2105&product_id=3590&version_id=&page=6&hasexp=0&opdos=0&opec=0&opov=0&opcsrf=0&opgpriv=0&opsqli=0&opxss=0&opdirt=0&opmemc=0&ophttprs=0&opbyp=0&opfileinc=0&opginf=0&cvssscoremin=0&cvssscoremax=0&year=0&month=0&cweid=0&order=1&trc=281&sha=9ddd526d6c3de20c88ac1e41f0bc477f1393cc17");
    	
   
	}
    
    public ArrayList<String> getTemp() {
		return temp;
	}

	private void getCVE(String url) throws IOException{
        Document doc = Jsoup.connect(url).get();

        Elements cves = doc.getElementsByClass("srrowns");
        
        for (int i = 0; i < cves.size(); i++) {     	
        	temp.add(cves.get(i).getAllElements().get(0).text());
        }
    }

	public int getId() {
		return id;
	}

	public void setId(int id) {
		this.id = id;
	}

	public List<BugsMoodle> getBugs() {
		return bugs;
	}

	public void setBugs(List<BugsMoodle> bugs) {
		this.bugs = bugs;
	}

	public String getVulnerability() {
		return vulnerability;
	}

	public void setVulnerability(String vulnerability) {
		this.vulnerability = vulnerability;
	}

	public void setTemp(ArrayList<String> temp) {
		this.temp = temp;
	}
	
	
}