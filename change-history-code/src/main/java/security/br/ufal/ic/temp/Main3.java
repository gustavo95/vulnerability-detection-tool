package security.br.ufal.ic.temp;

import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import security.br.ufal.ic.classification.ClassificationDataStatitics;
import security.br.ufal.ic.xen.ColectCommitsXen;
import security.br.ufal.ic.xen.XenClassify;

public class Main3 {

	public static void main(String[] args) {
		ArrayList<String> listCommits = new ArrayList<String>();
		String a = ColectCommitsXen.executarComando("git log " + "tools/libxl/libxl.c");

		Pattern pattern = Pattern.compile("(commit)\\s*(.*)");
		Matcher matcher = pattern.matcher(a);
		while (matcher.find()) {
			if (matcher.group(2).length() == 40) {
				listCommits.add(matcher.group(2));
			}

		}

		for (int i = listCommits.size() - 1; i > 0; i--) {

			String[] diff = {};
			ClassificationDataStatitics classify = null;
			XenClassify functionClassify = null;
			diff = ColectCommitsXen.executarComando(
					"git diff " + listCommits.get(i) + " " + listCommits.get(i - 1) + " " + "tools/libxl/libxl.c")
					.split("@@ -.*?@@");
			System.out.println(listCommits.get(i));
						for (String s : diff) {
				if (s.contains("int libxl__device_vfb_add(")) {
					System.out.println("achou");
					classify = new ClassificationDataStatitics("tools/libxl/libxl.c", s,
							"bec8f17e48439ee5b8370f4e431ccd9a9514bee7", " int libxl__device_vfb_add(");
					System.out.println(classify.getNConditionalExtraneousChanges());
					System.out.println(classify.getNFunctionCallExtraneousChanges());
					System.out.println(classify.getNFunctionCallMissingChanges());
				}
				else{
					System.out.println();
				}
			}
		}

	}
}
