/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package security.br.ufal.ic.temp;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

/**
 *
 * @author nmsa
 */
public class MarcusGroup {

    private static ArrayList<String[]> modules;

    public static void main(String[] args) {

        // init the mapping
        // nos temos R_ID, tu talvez nao tenhas
        modules = loadModules("SELECT m.PATH_START, m.MODULE_NAME "
                + "  FROM MODULE_INFO m "
                + " ORDER BY m.SEQUENCE;");

        // para cada instancia, para obter o module name
//        final String module = extractModule(filePath); // get module
//        if (module == null || "".equals(module)) {
//            System.out.println("Bode module = " + module);
//        }

    }

    private static ArrayList<String[]> loadModules(String query) {
        java.sql.Connection connector = null;
        try {
            connector = DriverManager.getConnection("jdbc:mysql://localhost/changehistory", "root", "admin");
            Class.forName("com.mysql.jdbc.Driver");
        } catch (SQLException | ClassNotFoundException ex) {
            System.out.println("Cannot get data = " + ex);
        }

        if (connector == null) {
            throw new RuntimeException("Cannot load modules");
        }
        ArrayList<String[]> dados = new ArrayList<String[]>();

        try {
            java.sql.Statement stm = connector.createStatement();
            try (ResultSet rs = stm.executeQuery(query)) {
                while (rs.next()) {
                    dados.add(new String[]{rs.getString("m.PATH_START"), rs.getString("m.MODULE_NAME")});
                }
            }
        } catch (Exception e) {
            System.out.println("Problem with data = " + e);
        } finally {
            try {
                connector.close();
            } catch (SQLException ex) {
                System.out.println("Problem closing data = " + ex);
            }
        }
        return dados;
    }

    private String extractModule(int r_id, String filePath) {
        String module = "default";
        for (String[] rule : modules) { // from top to bottom
            if (filePath.startsWith(rule[0])) { 
                return rule[1];
            }
        }
        return module;
    }
}
